"use strict";(self.webpackChunkheaven_admin=self.webpackChunkheaven_admin||[]).push([[327],{4327:(e,t,n)=>{n.r(t),n.d(t,{UpdateInlineImageDialog:()=>E,default:()=>K});n(1400);var a=n(5227),i=n(597),s=n(7405),l=n(82),o=n(7648),r=n(1333),c=n(6526),d=n(8920),u=n(2791),h=n(1517),p=n(5766),m=n(4478),f=n(202),g=n(1670),x=n(2140),v=n(2730),C=n(2729),j=n(9070),b=n(184);const w=new Set;function k(e){let{altText:t,className:n,imageRef:a,src:i,width:s,height:l,position:o}=e;return function(e){if(!w.has(e))throw new Promise((t=>{const n=new Image;n.src=e,n.onload=()=>{w.add(e),t(null)}}))}(i),(0,b.jsx)("img",{className:n||void 0,src:i,alt:t,ref:a,"data-position":o,style:{display:"block",height:l,width:s},draggable:"false"})}function E(e){let{activeEditor:t,nodeKey:n,onClose:a}=e;const i=t.getEditorState().read((()=>(0,d.gI)(n))),[s,l]=(0,u.useState)(i.getAltText()),[o,r]=(0,u.useState)(i.getShowCaption()),[c,h]=(0,u.useState)(i.getPosition());return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{style:{marginBottom:"1em"},children:(0,b.jsx)(C.Z,{label:"Alt Text",placeholder:"Descriptive alternative text",onChange:l,value:s,"data-test-id":"image-modal-alt-text-input"})}),(0,b.jsxs)(v.Z,{style:{marginBottom:"1em",width:"208px"},value:c,label:"Position",name:"position",id:"position-select",onChange:e=>{h(e.target.value)},children:[(0,b.jsx)("option",{value:"left",children:"Left"}),(0,b.jsx)("option",{value:"right",children:"Right"}),(0,b.jsx)("option",{value:"full",children:"Full Width"})]}),(0,b.jsxs)("div",{className:"Input__wrapper",children:[(0,b.jsx)("input",{id:"caption",type:"checkbox",checked:o,onChange:e=>{r(e.target.checked)}}),(0,b.jsx)("label",{htmlFor:"caption",children:"Show Caption"})]}),(0,b.jsx)(g.k,{children:(0,b.jsx)(m.Z,{"data-test-id":"image-modal-file-upload-btn",onClick:()=>(()=>{const e={altText:s,position:c,showCaption:o};i&&t.update((()=>{i.update(e)})),a()})(),children:"Confirm"})})]})}function K(e){let{src:t,altText:n,nodeKey:m,width:g,height:v,showCaption:C,caption:w,position:K}=e;const[_,y]=(0,h.Z)(),N=(0,u.useRef)(null),I=(0,u.useRef)(null),[S,B,D]=(0,r.y)(m),[L]=(0,i.g)(),[R,T]=(0,u.useState)(null),Z=(0,u.useRef)(null),M=(0,u.useCallback)((e=>{if(S&&(0,d.iO)((0,d.dL)())){e.preventDefault();const t=(0,d.gI)(m);if((0,j.sU)(t))return t.remove(),!0}return!1}),[S,m]),O=(0,u.useCallback)((e=>{const t=(0,d.dL)(),n=I.current;if(S&&(0,d.iO)(t)&&1===t.getNodes().length){if(C)return(0,d.oq)(null),e.preventDefault(),w.focus(),!0;if(null!==n&&n!==document.activeElement)return e.preventDefault(),n.focus(),!0}return!1}),[w,S,C]),P=(0,u.useCallback)((e=>(Z.current===w||I.current===e.target)&&((0,d.oq)(null),L.update((()=>{B(!0);const e=L.getRootElement();null!==e&&e.focus()})),!0)),[w,L,B]);(0,u.useEffect)((()=>{let e=!0;const t=(0,c.qV)(L.registerUpdateListener((t=>{let{editorState:n}=t;e&&T(n.read((()=>(0,d.dL)())))})),L.registerCommand(d.oj,((e,t)=>(Z.current=t,!1)),d.KB),L.registerCommand(d.Kr,(e=>{const t=e;return t.target===N.current&&(t.shiftKey?B(!S):(D(),B(!0)),!0)}),d.KB),L.registerCommand(d.XI,(e=>e.target===N.current&&(e.preventDefault(),!0)),d.KB),L.registerCommand(d.MK,M,d.KB),L.registerCommand(d.aR,M,d.KB),L.registerCommand(d.XN,O,d.KB),L.registerCommand(d.Zq,P,d.KB));return()=>{e=!1,t()}}),[D,L,S,m,M,O,P,B]);const U=S&&(0,d.iO)(R),q=S;return(0,b.jsxs)(u.Suspense,{fallback:null,children:[(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{draggable:U,children:[(0,b.jsx)("button",{className:"image-edit-button",ref:I,onClick:()=>{y("Update Inline Image",(e=>(0,b.jsx)(E,{activeEditor:L,nodeKey:m,onClose:e})))},children:"Edit"}),(0,b.jsx)(k,{className:q?"focused ".concat((0,d.iO)(R)?"draggable":""):null,src:t,altText:n,imageRef:N,width:g,height:v,position:K})]}),C&&(0,b.jsx)("div",{className:"image-caption-container",children:(0,b.jsxs)(l.d,{initialEditor:w,children:[(0,b.jsx)(a.C,{}),(0,b.jsx)(p.Z,{}),(0,b.jsx)(o.B,{contentEditable:(0,b.jsx)(f.Z,{className:"InlineImageNode__contentEditable"}),placeholder:(0,b.jsx)(x.Z,{className:"InlineImageNode__placeholder",children:"Enter a caption..."}),ErrorBoundary:s.Z})]})})]}),_]})}},82:(e,t,n)=>{n.d(t,{d:()=>d});var a={};n.r(a),n.d(a,{LexicalNestedComposer:()=>c});var i=n(1776),s=n(597),l=n(2791),o=function(e){const t=new URLSearchParams;t.append("code",e);for(let n=1;n<arguments.length;n++)t.append("v",arguments[n]);throw Error("Minified Lexical error #".concat(e,"; visit https://lexical.dev/docs/error?").concat(t," for the full message or use the non-minified dev environment for full errors and additional helpful warnings."))};function r(e){const t=e.transform();return null!==t?new Set([t]):new Set}function c(e){let{initialEditor:t,children:n,initialNodes:a,initialTheme:c,skipCollabChecks:d}=e;const u=(0,l.useRef)(!1),h=(0,l.useContext)(s.YK);null==h&&o(9);const[p,{getTheme:m}]=h,f=(0,l.useMemo)((()=>{const e=c||m()||void 0,n=(0,s.LI)(h,e);if(void 0!==e&&(t._config.theme=e),t._parentEditor=p,a)for(let i of a){let e=null,n=null;if("function"!=typeof i){const t=i;i=t.replace,e=t.with,n=t.withKlass||null}const a=t._nodes.get(i.getType());t._nodes.set(i.getType(),{exportDOM:a?a.exportDOM:void 0,klass:i,replace:e,replaceWithKlass:n,transforms:r(i)})}else{const e=t._nodes=new Map(p._nodes);for(const[n,a]of e)t._nodes.set(n,{exportDOM:a.exportDOM,klass:a.klass,replace:a.replace,replaceWithKlass:a.replaceWithKlass,transforms:r(a.klass)})}return t._config.namespace=p._config.namespace,t._editable=p._editable,[t,n]}),[]),{isCollabActive:g,yjsDocMap:x}=(0,i.Z)(),v=d||u.current||x.has(t.getKey());return(0,l.useEffect)((()=>{v&&(u.current=!0)}),[v]),(0,l.useEffect)((()=>p.registerEditableListener((e=>{t.setEditable(e)}))),[t,p]),l.createElement(s.YK.Provider,{value:f},!g||v?n:null)}const d=a.LexicalNestedComposer}}]);
//# sourceMappingURL=327.74e57c3a.chunk.js.map